var u=(e,r,t)=>new Promise((o,s)=>{var g=n=>{try{l(t.next(n))}catch(f){s(f)}},m=n=>{try{l(t.throw(n))}catch(f){s(f)}},l=n=>n.done?o(n.value):Promise.resolve(n.value).then(g,m);l((t=t.apply(e,r)).next())});import v from"axios";import k,{createContext as U,useContext as S,useEffect as d,useState as x}from"react";var y=U({user:null,setUser:e=>{},csrfToken:null,setCsrfToken:e=>{},config:null});function I({config:e,children:r}){let t=h(),[o,s]=x(JSON.parse(localStorage.getItem("user"))||null),g=JSON.parse(localStorage.getItem("csrfToken")),[m,l]=x(g),n=(c,p,T)=>{try{localStorage.setItem(p,JSON.stringify(T))}catch(P){localStorage.setItem(p,"")}c(T)},f=c=>{n(s,"user",c)},C=c=>{n(l,"csrfToken",c)};return d(()=>{function c(){return u(this,null,function*(){let p=yield t(e.csrfCookieUrl);C(p)})}c()},[]),k.createElement(y.Provider,{value:{user:o,setUser:f,csrfToken:m,setCsrfToken:C,config:e}},r)}function i(){return S(y)}import R from"axios";function a(){let{csrfToken:e,config:r}=i(),t=R.create({baseURL:r==null?void 0:r.baseUrl,withCredentials:!0,headers:{"Content-Type":"application/json",Accept:"application/json"}});return t.interceptors.request.use(o=>(o.headers["X-XSRF-TOKEN"]=e,o)),t}function h(){return r=>u(this,null,function*(){yield v.get(r);var t="";return document.cookie.split(";").forEach(o=>{o.split("=")[0].includes("XSRF-TOKEN")&&(t=o.split("=")[1].split("%")[0])}),t})}function A(e,r,t,o){return u(this,null,function*(){try{return yield t.post(e,r).then(s=>{if(s.status===200)return o(s.data),{success:!0}})}catch(s){return{success:!1,error:s}}})}function w(){let e=a(),{setUser:r,config:t}=i();return{login:s=>u(this,null,function*(){return yield A((t==null?void 0:t.loginUrl)||"",s,e,r)})}}function F(){let e=a(),{setUser:r,config:t}=i();return{register:s=>u(this,null,function*(){return yield A((t==null?void 0:t.registerUrl)||"",s,e,r)})}}function L(){let e=a(),{setUser:r,config:t}=i();return{logout:()=>u(this,null,function*(){try{yield e.post((t==null?void 0:t.logoutUrl)||"").then(s=>{if(s.status===200)return localStorage.removeItem("user"),r(null),{success:!0}})}catch(s){return{success:!1,error:s}}})}}export{I as AuthProvider,a as useApiClient,h as useFetchCsrfToken,w as useLogin,L as useLogout,F as useRegister};
//# sourceMappingURL=index.mjs.map