"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var i=(e,s,r)=>new Promise((n,t)=>{var g=o=>{try{p(r.next(o))}catch(l){t(l)}},h=o=>{try{p(r.throw(o))}catch(l){t(l)}},p=o=>o.done?n(o.value):Promise.resolve(o.value).then(g,h);p((r=r.apply(e,s)).next())});var _axios = require('axios'); var _axios2 = _interopRequireDefault(_axios);var _react = require('react'); var _react2 = _interopRequireDefault(_react);var y=_react.createContext.call(void 0, {user:null,setUser:e=>{},csrfToken:null,setCsrfToken:e=>{}});function S({children:e}){let s=m(),[r,n]=_react.useState.call(void 0, JSON.parse(localStorage.getItem("user"))||null),t=JSON.parse(localStorage.getItem("csrfToken")),[g,h]=_react.useState.call(void 0, t),p=(c,f,T)=>{try{localStorage.setItem(f,JSON.stringify(T))}catch(L){localStorage.setItem(f,"")}c(T)},o=c=>{p(n,"user",c)},l=c=>{p(h,"csrfToken",c)};return _react.useEffect.call(void 0, ()=>{function c(){return i(this,null,function*(){let f=yield s();l(f)})}c()},[]),_react2.default.createElement(y.Provider,{value:{user:r,setUser:o,csrfToken:g,setCsrfToken:l}},e)}function u(){return _react.useContext.call(void 0, y)}function a(){let{csrfToken:e}=u(),s=_axios2.default.create({baseURL:"http://localhost:80/",withCredentials:!0,headers:{"Content-Type":"application/json",Accept:"application/json"}});return s.interceptors.request.use(r=>(r.headers["X-XSRF-TOKEN"]=e,r)),s}function m(){let e=a();return(r="sanctum/csrf-cookie")=>i(this,null,function*(){yield _axios2.default.get(r);var n="";return document.cookie.split(";").forEach(t=>{t.split("=")[0].includes("XSRF-TOKEN")&&(n=t.split("=")[1].split("%")[0])}),n})}function x(e,s,r,n){return i(this,null,function*(){try{return yield r.post(e,s).then(t=>{if(t.status===200)return n(t.data),{success:!0}})}catch(t){return{success:!1,error:t}}})}function I(){let e=a(),{setUser:s}=u();return{login:(n="api/login",t)=>i(this,null,function*(){return yield x(n,t,e,s)})}}function w(){let e=a(),{setUser:s}=u();return{register:(n="api/register",t)=>i(this,null,function*(){return yield x(n,t,e,s)})}}function F(){let e=a(),{setUser:s}=u();return{logout:(n="api/logout")=>i(this,null,function*(){try{yield e.post(n).then(t=>{if(t.status===200)return localStorage.removeItem("user"),s(null),{success:!0}})}catch(t){return{success:!1,error:t}}})}}exports.AuthProvider = S; exports.useApiClient = a; exports.useAuth = u; exports.useFetchCsrfToken = m; exports.useLogin = I; exports.useLogout = F; exports.useRegister = w;
//# sourceMappingURL=index.js.map